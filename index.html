<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candidate Write-Up Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        #upload-area { border: 2px dashed #ccc; padding: 20px; text-align: center; margin-bottom: 20px; }
        #file-list { margin: 20px 0; }
        #result { margin-top: 20px; white-space: pre-wrap; }
        button { padding: 10px 15px; background: #007BFF; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Candidate Write-Up Generator</h1>
    <div id="upload-area">
        <input type="file" id="file-input" multiple accept=".pdf,.txt,.docx" />
    </div>
    <div id="file-list"></div>
    <button id="submit-btn" disabled>Submit to Mistral</button>
    <div id="result"></div>

    <script>
        const fileInput = document.getElementById('file-input');
        const fileList = document.getElementById('file-list');
        const submitBtn = document.getElementById('submit-btn');
        const resultDiv = document.getElementById('result');
        let uploadedFiles = [];

        fileInput.addEventListener('change', (e) => {
            uploadedFiles = Array.from(e.target.files);
            updateFileList();
        });

        function updateFileList() {
            fileList.innerHTML = '<h3>Uploaded Files:</h3>';
            uploadedFiles.forEach(file => {
                fileList.innerHTML += `<p>${file.name}</p>`;
            });
            submitBtn.disabled = uploadedFiles.length === 0;
        }

        async function extractTextFromFile(file) {
            if (file.type === 'application/pdf') {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                let text = '';
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    text += content.items.map(item => item.str).join(' ');
                }
                return text;
            } else if (file.name.endsWith('.docx')) {
                const arrayBuffer = await file.arrayBuffer();
                const result = await mammoth.extractRawText({ arrayBuffer });
                return result.value;
            } else {
                return await file.text();
            }
        }

        submitBtn.addEventListener('click', async () => {
          if (uploadedFiles.length === 0) return;
          resultDiv.innerHTML = "Processing...";
          try {
            let combinedText = '';
            for (const file of uploadedFiles) {
              combinedText += await extractTextFromFile(file) + '\n\n';
            }
            const response = await fetch('https://yebin-write-6aasnmp5n-theobtds-projects.vercel.app/api/generate-summary', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ text: combinedText })
            });
            const data = await response.json();
            resultDiv.innerHTML = `<strong>Result:</strong><br>${data.choices[0].message.content}`;
          } catch (error) {
            resultDiv.innerHTML = `Error: ${error.message}`;
          }
        });

    </script>
</body>
</html>
