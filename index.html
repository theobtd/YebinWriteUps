<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
</head>
<script>
    const fileInput = document.getElementById('file-input');
    const fileList = document.getElementById('file-list');
    const submitBtn = document.getElementById('submit-btn');
    const resultDiv = document.getElementById('result');

    let uploadedFiles = [];

    fileInput.addEventListener('change', (e) => {
        uploadedFiles = Array.from(e.target.files);
        updateFileList();
    });

    function updateFileList() {
        fileList.innerHTML = '<h3>Uploaded Files:</h3>';
        uploadedFiles.forEach(file => {
            fileList.innerHTML += `<p>${file.name}</p>`;
        });
        submitBtn.disabled = uploadedFiles.length === 0;
    }

    async function extractTextFromFile(file) {
        if (file.type === 'application/pdf') {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            let text = '';
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                text += content.items.map(item => item.str).join(' ');
            }
            return text;
        } else if (file.name.endsWith('.docx')) {
            const arrayBuffer = await file.arrayBuffer();
            const result = await mammoth.extractRawText({ arrayBuffer });
            return result.value;
        } else {
            return await file.text();
        }
    }

    submitBtn.addEventListener('click', async () => {
        if (uploadedFiles.length === 0) return;

        resultDiv.innerHTML = "Processing...";

        try {
            let combinedText = '';
            for (const file of uploadedFiles) {
                combinedText += await extractTextFromFile(file) + '\n\n';
            }

            const response = await fetch('https://api.mistral.ai/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer aAzvPqO3foGgDYMWAo5cNbksHkOS6Njb' // Your API key
                },
                body: JSON.stringify({
                    model: 'mistral-tiny',
                    messages: [{
                        role: 'user',
                        content: `You are an executive search headhunter at Korn Ferry. Write a [75; 150]-word summary of a candidate based on the following data:\n\n${combinedText}`
                    }]
                })
            });

            const data = await response.json();
            resultDiv.innerHTML = `<strong>Result:</strong><br>${data.choices[0].message.content}`;
        } catch (error) {
            resultDiv.innerHTML = `Error: ${error.message}`;
        }
    });
</script>


